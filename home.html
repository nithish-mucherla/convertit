<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Lato&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #303030;
        text-align: center;
        font-family: "Lato";
      }
      .heading {
        font-family: "Press Start 2P", cursive;
        color: whitesmoke;
        margin: 7vw 7vw;
      }
      .error {
        color: red;
        padding: 20px 20px;
      }

      .hidden {
        display: none;
      }
    </style>
  </head>
  <body onload="loadData()">
    <h1 class="heading">CONVERTIT</h1>
    <div class="container mt-3">
      <div class="input-group mb-3">
        <select
          id="countryCodesFrom"
          class="form-control"
          name="countryCodesForm"
          onchange="document.getElementById('countryCodeFromError').classList.add('hidden')"
        ></select>
        <div class="error hidden" id="countryCodeFromError">
          Please select a country code
        </div>
      </div>
      <div class="input-group mb-3">
        <input
          type="number"
          placeholder="from Value"
          id="fromValue"
          class="form-control"
          onchange="document.getElementById('fromValueError').classList.add('hidden')"
        />
        <div class="error hidden" id="fromValueError">
          Please Enter some value
        </div>
      </div>
      <div class="input-group mb-3">
        <select
          id="countryCodesTo"
          class="form-control"
          name="countryCodesTo"
          onchange="document.getElementById('countryCodeToError').classList.add('hidden')"
        ></select>
        <div class="error hidden" id="countryCodeToError">
          Please select a country code
        </div>
      </div>
      <div class="input-group mb-3">
        <input
          type="number"
          placeholder="To Value"
          id="toValue"
          class="form-control"
        />
      </div>
      <button onclick="validate()" class="btn btn-primary">CONVERT</button>
    </div>

    <script>
      const validate = () => {
        const from = document.getElementById("countryCodesFrom").value;
        const to = document.getElementById("countryCodesTo").value;
        const amount = document.getElementById("fromValue").value;
        if (!from) {
          document
            .getElementById("countryCodeFromError")
            .classList.remove("hidden");
          return;
        }

        if (!to) {
          document
            .getElementById("countryCodeToError")
            .classList.remove("hidden");
          return;
        }

        if (!amount) {
          document.getElementById("fromValueError").classList.remove("hidden");
          return;
        }

        if (amount <= 0) {
          let errorDiv = document.getElementById("fromValueError");
          errorDiv.innerHTML = "Please Enter a correct value";
          errorDiv.classList.remove("hidden");
          return;
        }
        convert();
      };
      const loadCountryCodes = async () => {
        let response = await fetch(
          "https://currency-converter13.p.rapidapi.com/list",
          {
            method: "GET",
            headers: {
              "x-rapidapi-key":
                "3d15874e0amshf1bdb48a55c5499p100e08jsn9ee781838fa3",
              "x-rapidapi-host": "currency-converter13.p.rapidapi.com",
            },
          }
        );
        return response.json();
      };

      const convert = async () => {
        const from = document.getElementById("countryCodesFrom").value;
        const to = document.getElementById("countryCodesTo").value;
        const amount = document.getElementById("fromValue").value;
        let response = await fetch(
          `https://currency-converter13.p.rapidapi.com/convert?from=${from}&to=${to}&amount=${amount}`,
          {
            method: "GET",
            headers: {
              "x-rapidapi-key":
                "3d15874e0amshf1bdb48a55c5499p100e08jsn9ee781838fa3",
              "x-rapidapi-host": "currency-converter13.p.rapidapi.com",
            },
          }
        );
        response.json().then((data) => {
          document.getElementById("toValue").value = data.amount;
        });
      };

      const loadData = () => {
        loadCountryCodes().then((data) => {
          optionList = `<option value="" disabled selected>select country code</option>`;
          data.forEach(
            (code) => (optionList += `<option value=${code}>${code}</option>`)
          );
          document.getElementById("countryCodesFrom").innerHTML = optionList;
          document.getElementById("countryCodesTo").innerHTML = optionList;
        });
      };
    </script>
  </body>
</html>
